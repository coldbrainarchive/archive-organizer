export async function onRequest({ request, env }) {
  if (request.method !== "POST") {
    return new Response("Method not allowed",{status:405});
  }

  const name = decodeURIComponent(
    request.headers.get("X-Filename") || "file.bin"
  );

  const body = await request.arrayBuffer();

  await env.ARCHIVE_BUCKET.put(name, body, {
    httpMetadata:{ contentType: request.headers.get("Content-Type") }
  });

  return json({ ok:true });
}

function json(d){
  return new Response(JSON.stringify(d),{
    headers:{ "Content-Type":"application/json" }
  });
}